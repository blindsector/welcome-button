<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>–¢–∞–µ–Ω –ß–∞—Ç v3</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#00c6ff,#0072ff);
  color:white;
}
.container {
  display:flex;
  gap:20px;
  padding:20px;
}
.box {
  flex:1;
  background: rgba(255,255,255,0.1);
  padding:15px;
  border-radius:15px;
}
h2 { margin-top:0 }
textarea {
  width:100%;
  height:90px;
  border-radius:10px;
  border:none;
  padding:10px;
  font-size:16px;
  resize:none;
}
button {
  margin-top:10px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:10px;
  background:#ff4757;
  color:white;
  font-size:16px;
  cursor:pointer;
}
.chatlog {
  background:white;
  color:black;
  height:150px;
  overflow:auto;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
  font-family:monospace;
}
.small {
  font-size:12px;
  opacity:0.8;
}
</style>
</head>
<body>

<div class="container">

  <!-- –õ–Ø–í–û: –¢–ò -->
  <div class="box">
    <h2>üß† –¢–∏ –ø–∏—à–µ—à –Ω–æ—Ä–º–∞–ª–Ω–æ</h2>
    <div id="chatNormal" class="chatlog"></div>
    <textarea id="inputText" placeholder="–ù–∞–ø–∏—à–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ..."></textarea>
    <button onclick="sendMessage()">–ò–∑–ø—Ä–∞—Ç–∏ ‚ûú</button>
  </div>

  <!-- –î–Ø–°–ù–û: –ö–û–î -->
  <div class="box">
    <h2>üîê –ö–æ–¥–∏—Ä–∞–Ω —Ç–µ–∫—Å—Ç</h2>
    <div id="chatEncoded" class="chatlog"></div>

    <h2>üì• –ü–µ–π—Å—Ç–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä (–∫–æ–¥–∏—Ä–∞–Ω)</h2>
    <textarea id="replyInput" placeholder="–ü–µ–π—Å—Ç–Ω–∏ –∫–æ–¥–∏—Ä–∞–Ω–∏—è –æ—Ç–≥–æ–≤–æ—Ä..."></textarea>
    <button onclick="decodeReply()">–†–∞–∑–∫–æ–¥–∏—Ä–∞–π ‚¨á</button>

    <h2>üí¨ –†–∞–∑–∫–æ–¥–∏—Ä–∞–Ω–æ</h2>
    <div id="chatDecoded" class="chatlog"></div>
  </div>

</div>

<script>
let baseDictionary = {
  "–∑–¥—Ä–∞–≤–µ–π":"–≥–ª—É–≤–µ–∫",
  "–∫–∞–∫":"—Ç—Ä–µ",
  "—Å–∏":"–º—É–ª—á–∞",
  "–ø—Ä–∏—è—Ç–µ–ª":"–¥—Ä—É–∂–∫–æ",
  "–¥–∞":"—Ç—Ä–æ–ª–∞",
  "–≤–∏–¥–∏–º":"–∫—Ä–∞–º—É–ª—è",
  "–ø—Ä–æ–±–≤–∞–º–µ":"–∑–æ—Ä—Ç–µ–∫",
  "–ø–ª–∞–Ω":"–º—Ä—è–∫",
  "—Ä–∞–±–æ—Ç–∞":"—á–æ–º–±–∞",
  "—Ç–∞–π–Ω–æ":"—à—É—à",
  "–ø–∞—Ä–∏":"—Ä–∏–±–∏",
  "–ø—Ä–æ–±–ª–µ–º":"—Ç—É–ª–±–∞",
  "–∂–µ–Ω–∞":"–∫–∞–∫–∞",
  "–º—ä–∂":"–±–∞—Ç–∫–∞"
};

let noiseWords = ["—à–ª—è–ø","–º—Ä—è–∫","–∑–æ—Ä—Ç","–±—É–º–∫–∞","—Ç—Ä—è—Å","–ø–ª—è—Å","–≤–∂–∂","–ø–ª—å–æ–∫"];

function shuffleWord(word){
  if(word.length < 4) return word;
  let mid = word.slice(1,-1).split('').sort(()=>Math.random()-0.5).join('');
  return word[0] + mid + word[word.length-1];
}

function addNoise(){
  return Math.random() < 0.3 ? noiseWords[Math.floor(Math.random()*noiseWords.length)] + " " : "";
}

function mutateDictionary(){
  for(let key in baseDictionary){
    if(Math.random() < 0.2){
      baseDictionary[key] = shuffleWord(baseDictionary[key]);
    }
  }
}

function encode(text){
  mutateDictionary(); // üß¨ –∂–∏–≤ —Ä–µ—á–Ω–∏–∫
  return text.split(" ").map(word=>{
    let clean = word.toLowerCase();
    if(baseDictionary[clean]){
      return addNoise() + shuffleWord(baseDictionary[clean]);
    }
    return shuffleWord(word);
  }).join(" ");
}

function decode(text){
  let reverse = {};
  for(let key in baseDictionary){
    reverse[baseDictionary[key]] = key;
  }

  return text.split(" ").map(word=>{
    let clean = word.toLowerCase();
    clean = clean.replace(/[^–∞-—è]/gi,"");
    if(reverse[clean]) return reverse[clean];
    return word;
  }).join(" ");
}

function sendMessage(){
  let input = document.getElementById("inputText");
  let normal = input.value;
  if(!normal.trim()) return;

  let encoded = encode(normal);

  document.getElementById("chatNormal").innerHTML += "üôÇ " + normal + "<br>";
  document.getElementById("chatEncoded").innerHTML += "üîê " + encoded + "<br>";

  input.value="";
}

function decodeReply(){
  let coded = document.getElementById("replyInput").value;
  let decoded = decode(coded);

  document.getElementById("chatDecoded").innerHTML += "ü§ñ " + decoded + "<br>";
  document.getElementById("replyInput").value="";
}
</script>

</body>
</html>
